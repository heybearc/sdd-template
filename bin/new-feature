#!/usr/bin/env bash
set -euo pipefail
TITLE="${*:-New Feature}"
SLUG="$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr -cs 'a-z0-9' - | sed 's/^-//;s/-$//')"
NUM=$(printf "%03d" "$(find specs -maxdepth 1 -type d -name '[0-9][0-9][0-9]-*' | wc -l)")
DIR="specs/${NUM}-${SLUG}"
mkdir -p "$DIR"
cat > "${DIR}/feature-spec.md" <<'MD'
# Feature: <name>
## Problem / Outcome
- Users need ...
- Success = ...

## Scope
- In: ...
- Out: ...

## User stories
- As a <role>, I want <behavior> so that <value>.

## Examples (Specification by Example)
- Example A (happy path):
  - Given ...
  - When ...
  - Then ...
- Example B (edge):
  - Given ...
  - When ...
  - Then ...

## Non-functional
- Performance: ...
- Security: ...
- Observability: ...

## Open questions
- [NEEDS CLARIFICATION: ...]
MD
git checkout -b "${NUM}-${SLUG}" 2>/dev/null || true
echo "Created $DIR and branch ${NUM}-${SLUG}"
